#!/usr/bin/env luajit
-- PGEC-WS Server Executable
-- Resolve project root relative to this script

local script_path = debug.getinfo(1, "S").source:sub(2)
local script_dir = script_path:match("(.*/)")

-- Add project root to package.path
package.path =
    script_dir .. "../?.lua;" ..
    script_dir .. "../?/init.lua;" ..
    package.path

local pgec = require('pgec')

print([[
╔═══════════════════════════════════════╗
║     PGEC Protocol Server v1.0         ║
║  Pretty Good Encrypted Chat           ║
║         WebSocket Edition             ║
╚═══════════════════════════════════════╝
]])

-- Parse command line arguments
local host = arg[1] or '0.0.0.0'
local port = tonumber(arg[2]) or 9110

print("Starting PGEC server...")
print("Host: " .. host)
print("Port: " .. port)
print()

-- Create and start server
local server = pgec.server.new({
   host = host,
   port = port
})

server:start()
